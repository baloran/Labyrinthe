var PersoHero=function(i){function e(i){i.lab.collisions(),i.lab.online=!0}var s=new Perso(i);return s.position=chiffre_aleatoire(s.lab.dimensions.totalCases),s.currentArme=0,s.armes=Config.armes.base,s.degats=s.armes[s.currentArme].degats,s.isMoving=!1,s.direction=0,$("#joueur").css({backgroundImage:"url("+Config.urls.assets.img.persos+Config.personnages.heros.pistolet+")"}),s.avancerTop=function(){0!=s.direction&&$("#joueur").animateRotate(0),s.direction=0,0==s.lab.murs[s.position][0]&&(s.position=s.position-s.lab.dimensions.casesPerLine,s.lab.moveMap(s.position)),e(s)},s.avancerBottom=function(){2!=s.direction&&$("#joueur").animateRotate(180),s.direction=2,0==s.lab.murs[s.position][2]&&(s.position=s.position+s.lab.dimensions.casesPerLine,s.lab.moveMap(s.position),e(s))},s.avancerLeft=function(){3!=s.direction&&$("#joueur").animateRotate(270),s.direction=3,0==s.lab.murs[s.position][3]&&(s.position--,s.lab.moveMap(s.position)),e(s)},s.avancerRight=function(){1!=s.direction&&$("#joueur").animateRotate(90),s.direction=1,0==s.lab.murs[s.position][1]&&(s.position++,s.lab.moveMap(s.position)),e(s)},s.die=function(){s.lab.callback(!1)},s.attack=function(){for(var i=!1,e=new Array(-s.lab.dimensions.casesPerLine,1,s.lab.dimensions.casesPerLine,-1),o=1;o<=s.armes[s.currentArme].portee;o++)if(!i){var n=s.lab.persosPositions[s.position+o*e[s.direction]];n&&(s.meet(n),i=!0)}},s.luminosite=function(){var i,e=3,o=!0,n=!0,a=!0,r=!0;for($("td div").css("opacity",0),$("#case_"+s.position).css("opacity",1),i=-1,j=s.position+1;j<s.position+e&&(i++,s.lab.dimensions.casesPerLine!=j%s.lab.dimensions.casesPerLine)&&!(j>=s.lab.dimensions.totalCases)&&1!=s.lab.murs[j][3];j++)0==s.lab.murs[j][3]&&1==o&&$("#case_"+j).css("opacity",1-.2*i);for(i=-1,j=s.position-1;j>s.position-e&&(i++,!(0>j))&&1!=s.lab.murs[j][1]&&(0==s.lab.murs[j][1]&&1==n&&$("#case_"+j).css("opacity",1-.2*i),j%s.lab.dimensions.casesPerLine!=0);j--);for(i=-1,j=s.position+s.lab.dimensions.casesPerLine;j<s.position+s.lab.dimensions.casesPerLine*e&&(i++,!(j>=s.lab.dimensions.totalCases))&&1!=s.lab.murs[j][0];j+=s.lab.dimensions.casesPerLine)0==s.lab.murs[j][0]&&1==r&&$("#case_"+j).css("opacity",1-.2*i);for(i=-1,j=s.position-s.lab.dimensions.casesPerLine;j>s.position-s.lab.dimensions.casesPerLine*e&&(i++,!(0>j))&&1!=s.lab.murs[j][2];j-=s.lab.dimensions.casesPerLine)0==s.lab.murs[j][2]&&1==a&&$("#case_"+j).css("opacity",1-.2*i)},$(window).bind("keydown",function(i){if(1!=s.isMoving){var e=i.keyCode;switch(e){case 39:s.avancerRight();break;case 37:s.avancerLeft();break;case 38:s.avancerTop();break;case 40:s.avancerBottom();break;case 32:s.attack();break;case 88:s.currentArme=(s.currentArme+1)%s.armes.length,s.degats=s.armes[s.currentArme].degats}}}),s.clear=function(){$(window).unbind("keydown")},s};